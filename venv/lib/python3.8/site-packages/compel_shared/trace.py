import tracemalloc
import atexit


def with_trace(func):
    def print_malloc():
        snapshot = tracemalloc.take_snapshot()
        top_stats = snapshot.statistics('lineno')

        print("[ Top 10 ]")
        for stat in top_stats[:10]:
            print(stat)

    atexit.register(print_malloc)
    tracemalloc.start()
    func()
